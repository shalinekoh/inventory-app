<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Items</title>
  </head>
  <body>
    <h1>Items</h1>
    <% items.forEach((item) => { %>
    <li><%=item.name%></li>
    <li><%= item.quantity%></li>
    <button
      type="button"
      class="editBtn"
      data-item-id="<%= item.id%>"
      data-item-name="<%= item.name %>"
      data-item-quantity="<%=item.quantity %>"
    >
      Edit
    </button>
    <dialog id="dialog-<%=item.id%>">
      <form method="POST" action="/item/<%=item.id%>/update">
        <input type="text" name="itemName" placeholder="Rename item" required />
        <input type="number" name="itemQuantity" min="1" required />
        <button type="button" id="cancel-<%=item.id%>">Cancel</button>
        <button type="submit">Enter</button>
      </form>
    </dialog>
    <form method="POST" action="/item/<%=item.id%>/delete">
      <button type="submit">Delete</button>
    </form>
    <% }); %>
    <script>
      const editButtons = document.querySelectorAll(".editBtn");
      editButtons.forEach((editBtn) => {
        const itemId = editBtn.getAttribute("data-item-id");
        const currentName = editBtn.getAttribute("data-item-name");
        const currentQuantity = editBtn.getAttribute("data-item-quantity");
        const dialog = document.getElementById(`dialog-${itemId}`);
        const cancelBtn = document.getElementById(`cancel-${itemId}`);

        editBtn.addEventListener("click", () => {
          const nameInput = dialog.querySelector('input[name="itemName"]');
          nameInput.value = currentName;
          const quantityInput = dialog.querySelector(
            'input[name="itemQuantity"]'
          );
          quantityInput.value = currentQuantity;
          dialog.showModal();
        });

        cancelBtn.addEventListener("click", () => {
          dialog.close();
        });
      });
    </script>
  </body>
</html>
